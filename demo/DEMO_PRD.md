# 反卷躺平系统 Demo 产品需求文档 (Demo PRD)

## 1. 项目背景
为了快速验证“反卷躺平可视化系统”的核心想法，我们需要构建一个轻量级的 Demo。该 Demo 旨在展示城市地图分布，并验证数据视图 `v_tangping_cities` 的可用性及交互体验。

## 2. 目标与范围
- **目标**: 快速搭建一个可运行的地图可视化原型，展示数据库中的躺平城市数据。
- **范围**: 
  - 仅包含一个核心地图页面。
  - 数据来源于本地 SQLite 数据库中的 `v_tangping_cities` 视图。
  - 所有代码和资源文件存放在 `demo/` 文件夹中。

## 3. 功能需求

### 3.1 地图展示
- **底图**: 使用高德地图 (AMap) 作为底图服务。
- **视野**: 默认以中国为中心，缩放级别适中，能够概览主要城市分布。

### 3.2 城市点位 (Markers)
- **数据加载**: 页面加载时自动从后端获取所有城市数据。
- **点位渲染**: 根据 `v_tangping_cities` 中的 `经度` 和 `纬度` 信息，在地图上生成标记 (Marker)。
- **视觉样式**: 使用默认标记或简单的自定义标记。

### 3.3 交互详情 (Popup)
- **点击交互**: 用户点击任意城市标记时，弹出信息窗体 (InfoWindow)。
- **信息展示**:
  - **城市名称**: (`城市`)
  - **省份**: (`省份`)
  - **排名**: (`排名`)
  - **房价**: (`二手房价格_元` / `套房价格_元`)
  - **舒适天数**: (`舒适天数`)
  - **绿化率**: (`绿化覆盖率`)

## 4. 技术方案

### 4.1 目录结构
所有文件位于项目根目录下的 `demo/` 文件夹：
- `demo/server.js`: 轻量级后端服务。
- `demo/index.html`: 前端页面。
- `demo/package.json`: 依赖管理。

### 4.2 技术栈 (Demo专用)
- **后端**: Node.js
  - 使用 `sqlite3` 驱动直接读取 `data/gapmap.db`。
  - 使用 `express` 或原生 `http` 模块提供简单的静态服务和 API 接口。
- **前端**: HTML5 + CSS + JavaScript (原生)
  - 引入高德地图 JS API (2.0版本)。
- **数据库**: SQLite (现有 `data/gapmap.db`)。

### 4.3 数据接口
- **API**: `GET /api/cities`
- **响应格式**:
  ```json
  [
    {
      "name": "鹤岗市",
      "province": "黑龙江省",
      "lat": 47.34,
      "lng": 130.28,
      "rank": 1,
      "price": 2200,
      ...
    }
  ]
  ```
  *(注：后端需将视图中的中文列名映射为英文键名，或前端直接处理中文键名)*

## 5. 执行计划
1.  **环境准备**: 创建 `demo` 目录及初始化 npm。
2.  **后端开发**: 编写 `server.js` 连接数据库并暴露 API。
3.  **前端开发**: 编写 `index.html` 实现地图加载和点位渲染。
4.  **联调测试**: 验证数据展示准确性及交互流畅度。
