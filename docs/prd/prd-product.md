# 反卷躺平可视化系统 产品需求文档(PRD)

## 一、数据来源梳理与可行性分析

### 1.1 基础城市数据

#### 1.1.1 地理与行政信息
**数据来源:**
- **高德地图API / 百度地图API**
  - 可行性: ★★★★★ (免费额度充足,稳定性高)
  - 数据内容: 城市边界、经纬度、行政区划、POI数据
  - 接口地址: https://lbs.amap.com/api/
  - 限制: 个人版5000次/天,企业版30万次/天

- **OpenStreetMap (OSM)**
  - 可行性: ★★★★★ (完全免费开源)
  - 数据内容: 详细地图数据、道路、建筑轮廓
  - 获取方式: https://www.openstreetmap.org/
  - 优点: 无限制使用,社区维护更新

#### 1.1.2 人口与经济数据
**数据来源:**
- **国家统计局官方网站**
  - 可行性: ★★★★☆ (免费但更新较慢)
  - 数据内容: 年度人口普查、GDP、人均收入、消费水平
  - 网址: http://www.stats.gov.cn/
  - 限制: 数据更新周期长(年度),需手动爬取

- **第一财经新一线城市研究所**
  - 可行性: ★★★☆☆ (部分数据收费)
  - 数据内容: 城市商业魅力指数、生活方式指数
  - 网址: https://www.datayicai.com/
  - 限制: 核心数据需付费购买

- **百度慧眼/个推数据平台**
  - 可行性: ★★☆☆☆ (主要面向企业客户,价格较高)
  - 数据内容: 人口流动、客流分析、消费行为
  - 限制: 需商业合作,个人难以获取

#### 1.1.3 生活成本数据
**数据来源:**
- **Numbeo数据库**
  - 可行性: ★★★★★ (全球最大免费生活成本数据库)
  - 数据内容: 房价、租金、食品价格、交通费用
  - API: https://www.numbeo.com/api/
  - 限制: 免费版有调用频率限制,部分城市数据依赖用户贡献

- **贝壳找房/链家数据**
  - 可行性: ★★★★☆ (可爬取但需注意反爬)
  - 数据内容: 实时房价、租金、小区信息
  - 获取方式: 网页爬虫
  - 限制: 需要处理反爬机制,数据量大

#### 1.1.4 医疗资源
**数据来源:**
- **高德地图POI数据**
  - 可行性: ★★★★★
  - 数据内容: 医院位置、等级、联系方式
  - 类型: 综合医院、专科医院、社区卫生中心

- **国家卫健委数据**
  - 可行性: ★★★☆☆
  - 数据内容: 医院等级评定、医疗资源统计
  - 网址: http://www.nhc.gov.cn/
  - 限制: 需手动整理

#### 1.1.5 交通设施
**数据来源:**
- **12306官网数据**
  - 可行性: ★★★★☆
  - 数据内容: 高铁站、火车站、线路信息
  - 获取方式: API或爬虫

- **航旅纵横/飞常准**
  - 可行性: ★★★☆☆
  - 数据内容: 机场信息、航班数据
  - 限制: 部分数据需付费

- **城市地铁官网**
  - 可行性: ★★★★☆
  - 数据内容: 地铁线路、站点分布
  - 获取方式: 各城市单独爬取

### 1.2 实时动态数据

#### 1.2.1 天气数据
**数据来源:**
- **和风天气API** (推荐)
  - 可行性: ★★★★★
  - 免费额度: 1000次/天
  - 数据内容: 实时天气、7天预报、空气质量、灾害预警
  - 网址: https://dev.qweather.com/
  - 优点: 数据全面,接口稳定,文档完善

- **OpenWeather API**
  - 可行性: ★★★★★
  - 免费额度: 100万次/月
  - 数据内容: 实时天气、5天预报、空气污染指数
  - 网址: https://openweathermap.org/api
  - 优点: 免费额度超大,全球覆盖

- **高德/百度天气API**
  - 可行性: ★★★★☆
  - 免费额度: 5000-30万次/天
  - 数据内容: 实时天气、简单预报
  - 限制: 数据相对简单,只区分白天/夜间

#### 1.2.2 新闻资讯
**数据来源:**
- **聚合数据新闻API**
  - 可行性: ★★★☆☆
  - 数据内容: 分类新闻、头条新闻
  - 网址: https://www.juhe.cn/
  - 限制: 免费版有调用次数限制

- **今日头条/腾讯新闻爬虫**
  - 可行性: ★★★☆☆
  - 数据内容: 城市相关新闻
  - 获取方式: 关键词搜索+爬虫
  - 限制: 需处理反爬,可能存在法律风险

- **百度新闻搜索**
  - 可行性: ★★★★☆
  - 数据内容: 城市相关新闻聚合
  - 获取方式: 搜索API或爬虫
  - 优点: 新闻来源广泛

### 1.3 社交媒体评价数据

#### 1.3.1 小红书数据
**数据来源方式:**

**方案一: 官方API (推荐但受限)**
- 可行性: ★★☆☆☆
- 途径: 小红书开放平台 (https://open.xiaohongshu.com/)
- 限制: 
  - 需要企业认证或专业号认证
  - 权限申请严格,个人开发者难以获取
  - 主要面向商业合作伙伴
- 数据内容: 笔记详情、评论、用户信息(需授权)

**方案二: 网页爬虫 (可行但有风险)**
- 可行性: ★★★☆☆
- 技术方案:
  - 使用Selenium/Playwright模拟浏览器
  - 通过移动端网页版降低反爬难度
  - 微信小程序抓包(需要技术手段)
- 限制:
  - 反爬机制严格(需要登录、验证码、滑块验证)
  - IP限制,需要代理池
  - 存在法律风险(违反平台服务条款)
  - 数据稳定性差,接口经常变化
- 获取数据: 城市关键词笔记、点赞数、评论内容、用户标签

**方案三: 第三方数据服务商**
- 可行性: ★★★★☆
- 服务商: 鲲鹏数据、新榜等
- 费用: 通常需付费订阅
- 数据内容: 清洗后的笔记数据、热度分析、情感分析
- 优点: 稳定性高,合规性好,数据质量有保证

**推荐策略:**
- 初期: 手动收集代表性笔记,建立城市标签库
- 中期: 使用温和爬虫(低频率,遵守robots.txt)获取公开数据
- 长期: 考虑付费第三方服务或与平台合作

#### 1.3.2 微博数据
**数据来源方式:**

**方案一: 微博开放平台API**
- 可行性: ★★★☆☆
- 网址: https://open.weibo.com/
- 限制:
  - 需要应用审核(需企业资质或个人认证)
  - 免费版接口权限非常有限
  - 搜索API需付费
- 数据内容: 公开微博、用户信息、评论(权限内)

**方案二: 微博搜索爬虫**
- 可行性: ★★★★☆
- 技术方案:
  - 移动端网页爬取(相对容易)
  - 使用Cookie池维持登录状态
  - 关键词搜索: "城市名+生活/定居/工作"等
- 限制:
  - 需要账号登录
  - 频率限制,需控制请求速度
  - IP封禁风险
- 获取数据: 微博内容、转发评论数、发布时间、用户画像

**方案三: 微博热搜监控**
- 可行性: ★★★★★
- 技术方案: 定时爬取微博热搜榜
- 数据内容: 城市相关热搜话题、热度值
- 优点: 公开数据,风险低

#### 1.3.3 其他社交平台
**知乎:**
- 可行性: ★★★★☆
- 方式: 网页爬虫
- 搜索关键词: "某某城市 怎么样"、"某某城市 定居"
- 数据: 问答内容、点赞数、评论

**豆瓣小组:**
- 可行性: ★★★★☆
- 方式: 网页爬虫
- 目标: 城市生活小组讨论
- 数据: 帖子内容、回复数

**马蜂窝/携程:**
- 可行性: ★★★★☆
- 数据内容: 城市旅游评价、景点评分
- 获取方式: API或爬虫

### 1.4 特色数据源

#### 1.4.1 气候宜居度
**数据来源:**
- **中国气象数据网**
  - 网址: http://data.cma.cn/
  - 数据: 历史气温、降水、日照、湿度
  - 限制: 部分数据需付费

- **WorldClim全球气候数据**
  - 网址: https://www.worldclip.org/
  - 数据: 高精度气候数据
  - 可行性: ★★★★★ (完全免费)

#### 1.4.2 生活节奏指标
**数据来源:**
- **高德地图拥堵指数**
  - 可行性: ★★★★☆
  - 数据: 城市拥堵排名、通勤时长

- **互联网加班指数**
  - 数据来源: 职友集、看准网等招聘平台
  - 数据: 企业加班情况、工作强度评价

#### 1.4.3 文化休闲设施
**数据来源:**
- **高德/百度POI**
  - 数据: 咖啡馆、书店、电影院、公园数量
  - 可行性: ★★★★★

- **大众点评数据**
  - 数据: 餐饮、娱乐场所评分
  - 可行性: ★★★☆☆ (需爬虫)

### 1.5 数据可行性总结

#### 高可行性数据(可立即获取):
1. ✅ 地图基础数据(高德/百度/OSM)
2. ✅ 天气数据(和风/OpenWeather)
3. ✅ POI数据(医院、交通、商业设施)
4. ✅ 生活成本数据(Numbeo)
5. ✅ 房价租金数据(贝壳/链家爬虫)

#### 中等可行性数据(需要技术处理):
1. ⚠️ 新闻资讯(爬虫+API组合)
2. ⚠️ 社交媒体评价(爬虫,需控制频率)
3. ⚠️ 人口流动数据(需付费或爬取运营商数据)

#### 低可行性数据(难以获取或成本高):
1. ❌ 详细人口统计(需付费购买专业数据)
2. ❌ 企业经营数据(需商业数据服务)
3. ❌ 深度社交媒体分析(需平台官方合作)

## 二、竞品分析

### 2.1 "明日故乡"

**产品定位:** 中国版数字游民指南

**核心功能:**
- 覆盖2206个城市(直辖市+地级市+县级市+自治州)
- 30项可筛选数据维度
- 四大筛选器:
  1. 经济指标(人均收入、GDP、消费水平)
  2. 基础设施(高铁、机场、快递覆盖、星巴克、麦当劳、健身房)
  3. 天气气候(晴天数、雨天数、温度范围、日照时长)
  4. 地理位置(沿海、内陆、海拔)

**优点:**
- 数据维度全面,筛选功能强大
- UI简洁,操作直观
- 免费使用
- 数据来源公开透明

**不足:**
- 缺少实时数据(天气、新闻)
- 没有社交媒体评价整合
- 地图可视化较弱
- 无城市详情页深度信息
- 数据更新频率不明

**对我们的启示:**
- ✅ 借鉴多维度筛选器设计
- ✅ 学习数据呈现的简洁性
- ❌ 加强地图可视化交互
- ❌ 补充实时数据和社交评价

### 2.2 百度慧眼"城市人口地理大数据平台"

**产品定位:** To B的城市数据分析平台

**核心功能:**
- 城市级实时/历史客流查询
- 人口热力图
- 区域评估(区县、街道、地块)
- 商圈分析
- 交通监测

**优点:**
- 数据精度高(基于百度地图大数据)
- 实时性强
- 可视化效果专业
- 支持多粒度分析

**不足:**
- 面向企业客户,需付费
- 界面复杂,学习成本高
- 不关注个人生活指标
- 无社交媒体数据

**对我们的启示:**
- ✅ 学习热力图等可视化方式
- ✅ 借鉴多尺度数据展示
- ❌ 简化操作,面向个人用户
- ❌ 增加生活化指标

### 2.3 第一财经"新一线城市知城数据平台"

**产品定位:** 城市商业魅力研究

**核心功能:**
- 城市分级排名
- 商业资源集聚度分析
- 城市枢纽性评价
- 生活方式多样性指数
- 产业带数据

**优点:**
- 数据专业性强
- 排名体系科学
- 报告质量高

**不足:**
- 主要关注大城市
- 中小城市数据缺失
- 数据更新周期长(年度)
- 需付费购买完整数据

**对我们的启示:**
- ✅ 参考城市评价指标体系
- ❌ 扩展至更多中小城市
- ❌ 提供实时/高频更新

### 2.4 Numbeo

**产品定位:** 全球生活成本数据库

**核心功能:**
- 生活成本比较
- 房价租金数据
- 购买力指数
- 污染指数
- 交通指数
- 健康医疗指数

**优点:**
- 全球覆盖
- 数据维度丰富
- 用户贡献模式,数据量大
- 完全免费
- 支持城市对比

**不足:**
- 中国城市数据相对较少
- 数据准确性依赖用户贡献
- 无地图可视化
- 无实时数据

**对我们的启示:**
- ✅ 借鉴生活成本指标体系
- ✅ 学习城市对比功能
- ❌ 补充中国城市数据
- ❌ 增加地图展示

### 2.5 其他相关产品

**智慧城市可视化大屏(UINO、山海鲸等):**
- 定位: To G/To B
- 特点: 3D可视化效果震撼,但面向政府决策
- 启示: 可视化技术可借鉴,但需简化

**城市选择顾问服务:**
- 定位: 人工咨询服务
- 特点: 个性化推荐,但收费高昂
- 启示: 我们的系统可以提供类似价值但免费

### 2.6 竞品对比总结

| 维度 | 明日故乡 | 百度慧眼 | 一财知城 | Numbeo | 我们的系统 |
|------|----------|----------|----------|---------|------------|
| 城市覆盖 | 2206个 | 全国主要城市 | 主要一二线 | 全球(中国较少) | 个人感兴趣城市 |
| 数据维度 | 30项 | 人口/交通为主 | 商业指标 | 生活成本为主 | 全面+实时 |
| 地图可视化 | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐ | ⭐⭐⭐⭐ |
| 实时数据 | ❌ | ✅ | ❌ | ❌ | ✅ |
| 社交评价 | ❌ | ❌ | ❌ | ❌ | ✅ |
| 用户门槛 | 低 | 高 | 中 | 低 | 低 |
| 费用 | 免费 | 付费 | 部分付费 | 免费 | 免费 |

**我们的差异化优势:**
1. ✨ 地图中心设计,可视化交互强
2. ✨ 可扩展动态数据(天气、新闻等在 Phase 2 接入)
3. ✨ 融合社交媒体真实评价
4. ✨ 个性化城市收藏与对比
5. ✨ 针对"慢生活"需求的专属指标

## 三、产品需求文档(PRD)

### 3.1 产品概述

#### 3.1.1 产品名称
**反卷躺平可视化系统** (Slow City Explorer)

#### 3.1.2 产品定位
一个以地图为中心的个人化城市信息聚合与可视化系统,帮助用户发现和评估适合"慢生活"的城市,通过整合多维度数据和真实社交评价,为追求工作生活平衡的人群提供决策支持。

#### 3.1.3 目标用户
- **主要用户:** 你自己(初期)
- **潜在扩展用户:**
  - 考虑换城市发展的职场人士
  - 追求"慢生活"理念的年轻人
  - 数字游民
  - 准备退休或养老的人群
  - 远程工作者

#### 3.1.4 核心价值
1. 节省信息搜集时间,一站式获取城市多维度数据
2. 通过可视化地图直观对比城市特征
3. 整合官方数据与真实社交评价,信息更全面
4. 发现隐藏的宜居小城市

#### 3.1.5 MVP范围与验收标准

**MVP范围 (Phase 1-2):**
- 地图浏览与城市点位展示（缩放/拖拽/搜索）
- 城市详情页/信息卡片：展示基础信息与分维度指标（不做综合总分/综合排名）
- 城市对比：支持2-4个城市的分维度对比
- 筛选与排序：按条件筛选 + 按单指标排序
- 数据管理：支持以管理入口/脚本方式更新城市数据（增删改查）

**明确不做 (MVP不包含):**
- 动态数据：天气/新闻（Phase 2，非MVP）
- 综合躺平指数/排名（Phase 2，非MVP）

**MVP验收标准:**
- 地图可正常加载并展示不少于5-10个测试城市点位
- 点击城市点位可打开详情卡片/页面，并展示关键分维度字段（例如：房价/租金、医疗资源、交通可达性等）
- 支持筛选（至少3个条件）与排序（至少2个单指标）且结果正确
- 支持城市对比（至少2城）且对比维度清晰
- 数据更新后前台可读取到最新数据

**MVP关键风险与应对:**
- 数据口径不一致：优先引入可验证的基础指标；每个字段保留来源与更新时间
- 爬虫不稳定/封禁：MVP 以低频 + 可人工兜底推进；AI识别与大规模抓取放到 Phase 2
- 性能风险：控制城市数量与字段规模；前端按需加载详情

### 3.2 功能需求

#### 3.2.1 核心功能

##### 功能1: 交互式地图展示
**需求描述:**
- 以中国地图为主界面,显示所有感兴趣的城市标记
- 支持缩放、拖拽、城市搜索
- 标记样式根据城市属性动态变化(颜色/大小表示不同维度)

**技术方案:**
- 使用 **AntV L7** 地图可视化引擎 + 高德地图底图
- 城市标记点击打开详情卡片
- 支持图层切换(显示不同数据维度，如热力图、气泡图)

**优先级:** P0 (最高)

##### 功能2: 城市基础信息面板
**需求描述:**
点击城市标记后,显示城市基础信息卡片:

**数据模块:**
1. **地理概况**
   - 位置坐标
   - 行政级别
   - 面积与人口
   - 地形地貌

2. **经济水平**
   - 人均GDP
   - 城镇居民收入
   - 消费水平指数

3. **生活成本**
   - 平均房价
   - 平均租金
   - 日常消费(餐饮、交通)
   - 房价收入比

4. **医疗资源**
   - 三甲医院数量
   - 医院列表(名称、等级、位置)
   - 人均医疗资源

5. **交通设施**
   - 高铁站(是否有、班次密度)
   - 机场(是否有、航班城市数)
   - 地铁(是否有、线路数)
   - 市内交通(公交覆盖度)

6. **教育资源**
   - 高校数量
   - 重点高中数量

7. **基础设施**
   - 商业设施(商场、超市密度)
   - 文化设施(图书馆、博物馆、电影院)
   - 休闲设施(咖啡馆、公园、健身房)

**数据来源:**
- 高德地图POI
- 国家统计局
- Numbeo
- 贝壳找房

**优先级:** P0

##### 功能3: 实时数据面板（Phase 2，非MVP）
**需求描述:**
显示城市当前实时动态信息:

**数据模块:**
1. **当前天气**
   - 实时温度、天气状况
   - 空气质量AQI
   - 风力风向
   - 湿度

2. **天气预报**
   - 未来7天天气
   - 温度趋势图
   - 降水概率

3. **气象预警**
   - 台风、暴雨、高温等预警

4. **最近新闻**
   - 城市相关新闻标题+摘要(最近7天)
   - 新闻来源与发布时间
   - 点击跳转原文链接

**数据来源:**
- 和风天气API
- 百度新闻搜索
- 聚合数据新闻API

**更新频率:**
- 天气: 每小时更新
- 新闻: 每日更新

**优先级:** P2（Phase 2，非MVP）

##### 功能4: 社交媒体评价聚合
**需求描述:**
针对重点关注城市,聚合社交媒体上的真实评价:

**数据模块:**
1. **小红书笔记**
   - 搜索关键词: "城市名+生活/定居/工作/旅居"
   - 展示: 笔记标题、封面图、点赞数、发布时间
   - 数量: 最新20-50条
   - 点击跳转小红书原文

2. **微博讨论**
   - 搜索关键词: "城市名+生活/评价"
   - 展示: 微博内容、转评赞数、发布时间
   - 数量: 最新20-50条

3. **知乎问答**
   - 搜索关键词: "城市名+怎么样/值得去吗"
   - 展示: 问题标题、高赞回答摘要、点赞数
   - 数量: 相关问题5-10个

4. **情感分析** (可选,V2版本)
   - 对评价文本进行情感分析
   - 显示正面/中性/负面评价占比
   - 提取高频关键词(词云)

**数据获取方式:**
- 初期: 手动收集+定期更新
- 中期: 低频爬虫(每周/每月更新)
- 长期: 考虑付费数据服务

**优先级:** P1 (仅对重点城市实现)

##### 功能5: 城市对比功能
**需求描述:**
支持选择2-4个城市进行多维度对比:

说明：MVP 阶段不提供“综合总分/综合排名”，对比以各维度指标展示为主；综合指数/排名在 Phase 2 迭代。

**对比维度:**
- 生活成本(房价、租金、消费)
- 气候(年均温度、降水、晴天数)
- 交通(高铁/机场可达性)
- 医疗教育资源
- 休闲设施密度
- 人口密度

**展示方式:**
- 雷达图
- 柱状图对比
- 表格对比

**优先级:** P1

##### 功能6: 个性化收藏与标签
**需求描述:**
- 收藏感兴趣的城市
- 为城市添加自定义标签(如"备选"、"已考察"、"待深入了解")
- 添加个人笔记

**数据存储:**
- LocalStorage(浏览器本地存储)
- 后期可扩展用户账号系统

**优先级:** P1

#### 3.2.2 辅助功能

##### 功能7: 数据筛选与排序
**需求描述:**
- 按条件筛选城市:
  - 房价范围
  - 温度范围
  - 是否有高铁/机场
  - 人口规模
  - 沿海/内陆
- 按单指标排序显示

说明：MVP 阶段不提供“综合总分/综合排名”，仅支持按单指标排序；综合指数/排名在 Phase 2 迭代。

**技术方案:**
- ECharts / Chart.js

**优先级:** P2

##### 功能8: 数据图表可视化
**需求描述:**
- 城市数据趋势图(如房价历史走势)
- 气候年度分布图
- 多城市指标对比图

**技术方案:**
- ECharts / Chart.js

**优先级:** P2

##### 功能9: 数据导出
**需求描述:**
- 导出城市对比表格(Excel/CSV)
- 导出城市详情报告(PDF)

**优先级:** P3

#### 3.2.4 移动端专属功能 📱

##### 功能10: 移动地图交互优化
**需求描述:**
- **手势操作**: 双指缩放、单指拖拽、双击放大，符合移动端操作习惯
- **定位服务**: 自动获取GPS定位，显示当前位置附近的躺平城市
- **离线地图**: 缓存已查看的城市数据，无网络环境下仍可浏览基础信息
- **AR实景** (V3): 扫描周边环境，实时显示附近设施的躺平评分

**优先级:** P1 (移动端核心功能)

##### 功能11: 移动端快捷操作
**需求描述:**
- **城市收藏**: 长按地图上的城市标记，快速添加到收藏夹
- **语音搜索**: 语音输入城市名称或搜索条件（如"房价低于1万的城市"）
- **摇一摇推荐**: 摇动手机随机推荐一个躺平城市，增加趣味性
- **分享功能**: 一键生成精美的城市信息卡片图片，支持分享到微信、小红书等社交平台

**优先级:** P2 (提升移动端体验)

##### 功能12: 移动场景适配
**需求描述:**
- **通勤分析**: 输入公司地址，自动计算各候选城市的通勤时间和成本
- **周边探索**: 基于当前位置，显示周边的躺平社区评价和生活设施
- **旅行模式**: 实地考察时可记录笔记、拍照上传，标记优缺点
- **消息推送**: 关注城市的房价变动、天气预警等重要信息实时推送

**优先级:** P2 (增强场景化体验)

##### 功能13: 轻量级小程序版本
**需求描述:**
- **微信小程序**: 开发小程序版本，无需下载即可快速查询
- **核心功能**: 城市搜索、基础信息查看、简单对比功能
- **数据同步**: 小程序与主应用数据实时同步，保持一致性
- **社交传播**: 利用微信生态，便于用户分享和传播

**优先级:** P3 (扩展用户覆盖面)

### 3.3 非功能需求

#### 3.3.1 性能需求
- 地图加载时间 < 3秒
- 城市数据加载时间 < 2秒
- 支持同时展示50+城市标记无卡顿

#### 3.3.2 兼容性需求
**桌面端:**
- 支持主流浏览器: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- 屏幕分辨率: 1366x768 及以上

**移动端:**
- **操作系统**: iOS 14+, Android 8+
- **浏览器**: Safari, Chrome, 微信内置浏览器, UC浏览器
- **屏幕适配**: 
  - 手机: 320px - 414px 宽度
  - 平板: 768px - 1024px 宽度
  - 支持横屏和竖屏切换
- **PWA支持**: 
  - iOS Safari: 支持添加到主屏幕
  - Android Chrome: 支持安装为应用
  - 离线访问已缓存的城市数据
- **微信小程序**: 微信版本 8.0+
- **原生功能兼容**:
  - GPS定位: 支持高精度定位和粗略定位
  - 相机: 支持拍照和相册选择
  - 本地存储: IndexedDB + LocalStorage
  - 推送通知: 支持浏览器推送和微信订阅消息

#### 3.3.3 数据更新策略
| 数据类型 | 更新频率 | 更新方式 |
|----------|----------|----------|
| 基础城市信息 | 半年/年 | 手动更新 |
| 房价租金 | 月度 | 定时爬虫 |
| 天气数据（Phase 2，非MVP） | 实时 | API自动更新 |
| 新闻资讯（Phase 2，非MVP） | 每日 | API自动更新 |
| 社交媒体评价 | 周/月 | 定时爬虫 |
| POI数据 | 季度 | API更新 |

#### 3.3.4 系统架构

**前端技术栈:**
```
框架: SvelteKit 2.0 (编译时框架，无虚拟DOM，性能优异)
地图: AntV L7 + 高德地图 JS API 2.0 (专业可视化)
UI库: Flowbite Svelte + TailwindCSS
图表: Chart.js / ECharts
状态管理: Svelte内置响应式 (无需Vuex/Redux)
构建工具: Vite
```

**移动端适配:**
- **响应式设计**: TailwindCSS断点系统（sm/md/lg/xl）
- **PWA支持**: 
  - SvelteKit PWA插件
  - Service Worker缓存策略
  - Web App Manifest配置
  - 支持离线访问已缓存数据
- **触摸优化**: 
  - Hammer.js手势识别
  - 300ms点击延迟优化
  - 最小触摸目标44x44px
- **性能优化**:
  - 图片懒加载 + WebP格式
  - 路由级代码分割
  - 数据虚拟滚动
  - 初始加载体积 < 500KB

**后端架构:**
```
运行时: Node.js 20+
框架: SvelteKit API Routes (内置，无需Express)
ORM: Prisma (类型安全，迁移方便)
数据库: 
  - 开发: SQLite (轻量，无需安装)
  - 生产: PostgreSQL (Supabase免费版500MB)
认证: 环境变量简单密码 (个人使用)
```

**数据采集层:**
```
浏览器自动化: Playwright (支持Chrome/Firefox/WebKit)
定时任务: node-cron (纯Node.js实现)
AI识别: Claude/GPT-4 Vision API
  - 截图识别，对抗反爬
  - 成本: ~$2/月 (200次识别)
  - 适合小红书、微博等严格反爬平台
```

**部署方案:**
```
前端+API: Vercel (免费，全球CDN，自动部署)
数据库: Supabase PostgreSQL (免费500MB)
爬虫: 本地Cron / GitHub Actions定时执行
域名: 可选购自定义域名或使用vercel.app子域名
```

**技术选型优势:**
1. **SvelteKit**: 打包体积小40-60%，代码量少30-50%，适合个人项目快速开发
2. **全栈一体**: 前后端同一框架，API路由内置，开发效率高
3. **TypeScript原生支持**: 类型安全，维护成本低
4. **PWA开箱即用**: 轻松实现离线访问和安装到主屏幕
5. **Playwright**: 反爬能力强，支持截图+AI识别创新方案

### 3.4 产品原型设计

#### 3.4.1 主界面布局
```
┌────────────────────────────────────────────────────┐
│  [Logo] 反卷躺平城市可视化    [搜索框]  [筛选] [对比] │
├────────────────────────────────────────────────────┤
│                                                    │
│                                                    │
│                  [地图主界面]                       │
│                (城市标记点)                         │
│                                                    │
│                                                    │
│                                                    │
├────────────────────────────────────────────────────┤
│ [我的收藏] [最近查看] [热门城市] [统计面板]           │
└────────────────────────────────────────────────────┘
```

#### 3.4.2 城市详情面板
```
┌─────────────────────────────────────┐
│ [城市名称]                [收藏] [×]  │
├─────────────────────────────────────┤
│                                     │
│ [Tab: 基础信息] [动态数据（Phase 2）] [社交评价] │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 地理概况                         │ │
│ │ • 人口: XXX万                    │ │
│ │ • 面积: XXXkm²                   │ │
│ │ • 位置: [小地图]                 │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 生活成本                         │ │
│ │ • 房价: XX元/m²                  │ │
│ │ • 租金: XX元/月                  │ │
│ │ [成本详情图表]                   │ │
│ └─────────────────────────────────┘ │
│                                     │
│ [更多信息...]                        │
└─────────────────────────────────────┘
```

#### 3.4.3 城市对比界面
```
┌──────────────────────────────────────────┐
│ 城市对比 (最多4个)                         │
├──────────────────────────────────────────┤
│ [城市A] vs [城市B] vs [城市C]  [+ 添加]   │
├──────────────────────────────────────────┤
│                                          │
│         [雷达图对比]                      │
│                                          │
├──────────────────────────────────────────┤
│                                          │
│  指标      城市A    城市B    城市C        │
│  ────────────────────────        │
│  房价      15k     12k      8k           │
│  气温      18°C    22°C     16°C         │
│  医院      15家    8家      5家           │
│  ...                                     │
│                                          │
└──────────────────────────────────────────┘
```

### 3.5 开发路线图 (10周)

#### Phase 1: 基础架构搭建 (第1周)
**目标:** 搭建SvelteKit项目 + AntV L7 地图集成

**任务清单:**
- [x] 初始化SvelteKit项目
  ```bash
  npm create svelte@latest gap-map
  cd gap-map
  npm install
  ```
- [x] 安装核心依赖
  ```bash
  npm install -D tailwindcss @skeletonlabs/skeleton
  npm install prisma @prisma/client
  npm install @antv/l7 @antv/l7-maps
  ```
- [x] 配置TailwindCSS + Skeleton UI
- [x] 注册高德地图API Key和安全密钥
- [x] 创建地图组件 `L7Map.svelte`
- [x] 实现城市数据可视化展示(PointLayer/HeatmapLayer)
- [x] 初始化Prisma数据库
- [x] 手动录入5-10个目标城市测试数据

**验收标准:**
- 地图正常加载，显示高德暗色底图
- 城市标记使用 L7 PointLayer 正确显示
- 点击标记弹出城市信息卡片

#### Phase 2: 后台管理端开发 (第2周)
**目标:** 实现城市数据的增删改查管理界面

**任务清单:**
- [ ] 创建后台路由结构 `/admin`
- [ ] 实现城市列表页
  - 表格展示所有城市
  - 搜索和过滤功能
  - 分页显示
- [ ] 实现城市新增/编辑表单
  - 表单字段验证
  - 地图选点（点击地图自动填充经纬度）
  - 图片上传（城市封面图，可选）
- [ ] 实现API路由
  - `GET /api/cities` - 获取城市列表
  - `POST /api/cities` - 新增城市
  - `PUT /api/cities/:id` - 更新城市
  - `DELETE /api/cities/:id` - 删除城市
- [ ] 添加简单身份验证（环境变量密码）

**验收标准:**
- 能通过管理后台添加新城市
- 编辑城市信息后前台立即更新
- 删除城市功能正常

#### Phase 2 Backlog: 动态数据（天气/新闻）
 **目标:** 接入天气API和新闻数据（Phase 2，非MVP）
 
 **任务清单:**
 - [ ] 注册和风天气API账号
 - [ ] 创建天气数据代理API
   ```typescript
   // src/routes/api/weather/[city]/+server.ts
   export async function GET({ params }) {
     const weather = await fetchWeather(params.city);
     await saveWeatherToDB(params.city, weather);
     return json(weather);
   }
   ```
 - [ ] 前端展示天气组件
   - 当前天气卡片
   - 7天预报图表
   - 空气质量指数
 - [ ] 创建新闻爬虫脚本（百度新闻）
 - [ ] 实现定时任务
   - 天气: 每小时更新一次
   - 新闻: 每天8点更新
 
 **验收标准:**
 - 城市详情页显示实时天气
 - 显示最近7天天气预报
 - 显示城市相关新闻（最近3天）

#### Phase 3: Playwright爬虫开发 (第3-4周)
 **目标:** 实现房价和基础POI数据爬取
 
 **任务清单:**
 - [ ] 安装Playwright
  ```bash
  npm install playwright
  npx playwright install chromium
  ```
- [ ] 开发贝壳找房爬虫
  - 爬取城市平均房价
  - 爬取租金数据范围
- [ ] 开发高德POI爬虫
  - 医院数量统计
  - 咖啡馆、公园、健身房数量
- [ ] 实现爬虫日志记录
  - 记录爬取时间、城市、结果
  - 错误日志和截图
- [ ] 后台管理端添加"手动触发爬虫"按钮

 **验收标准:**
 - 能自动更新城市房价数据
 - POI统计数据准确
 - 爬虫日志可查看
 
#### Phase 4: AI识别爬虫 (第5-6周)
 **目标:** 实现小红书和微博评价数据抓取
 
 **任务清单:**
 - [ ] 注册Claude API账号
 - [ ] 开发AI通用爬虫框架
   ```javascript
   // scrapers/ai-scraper.js
   await scrapeWithAI(url, prompt);
   ```
 - [ ] 实现小红书笔记爬取
   - 截图搜索结果页
   - AI识别笔记标题、作者、点赞数
   - 保存到数据库
 - [ ] 实现微博内容爬取
 - [ ] 前端展示社交媒体评价
   - Tab切换（小红书/微博/知乎）
   - 卡片式展示
   - 点击跳转原文链接
 - [ ] 实现每周定时更新（重点城市）

 **验收标准:**
 - 重点城市能看到最新小红书笔记（20-50条）
 - AI识别准确率 > 85%
 - 截图和识别结果可追溯
 
#### Phase 5: 高级功能 (第7-8周)
 **目标:** 城市对比、筛选、数据可视化
 
 **任务清单:**
 - [ ] 实现城市对比功能
   - 选择2-4个城市
   - 雷达图对比（多维度）
   - 表格对比（详细数据）
 - [ ] 实现筛选排序
   - 按房价范围筛选
   - 按气温范围筛选
   - 按设施数量排序
 - [ ] 数据可视化增强
   - 房价趋势图（历史走势）
   - 气候年度分布图
   - 城市分布热力图
 - [ ] 移动端基础适配
   - 响应式布局调整
   - 触摸目标大小优化
 
 **验收标准:**
 - 城市对比功能流畅
 - 筛选结果准确
 - 图表展示清晰
 
#### Phase 6: 移动端开发与优化 (第9-10周)
 **目标:** 打造原生级移动端体验，支持PWA和小程序
 
 **任务清单:**
 - [ ] **响应式深度适配**
   - 适配手机（320px-414px）和平板（768px-1024px）
   - 优化触摸目标大小（最小44x44px）
   - 调整字体大小和行高，提升可读性
   - 底部导航栏设计（符合移动端习惯）
  
 - [ ] **PWA应用化**
   - 配置Web App Manifest
   - 实现Service Worker缓存策略
   - 添加"添加到主屏幕"提示
   - 离线功能支持（缓存已查看城市数据）
  
 - [ ] **手势交互优化**
   - 双指缩放地图优化
   - 左滑返回上一页
   - 长按城市标记显示快捷菜单
   - 下拉刷新数据
  
 - [ ] **原生功能集成**
   - 调用设备GPS定位
   - 获取当前位置天气
   - 相机API：实地考察拍照上传
   - Web Share API：生成城市卡片分享
  
 - [ ] **性能深度优化**
   - 路由级代码分割（减少初始加载）
   - 图片WebP格式 + 懒加载
   - 虚拟滚动（城市列表）
   - 初始加载体积 < 500KB
  
 - [ ] **微信小程序开发**
   - 使用uni-app或Taro框架开发
   - 实现核心功能：搜索、查看、收藏、简单对比
   - 与主应用数据同步
   - 提交微信审核上线
  
 - [ ] **移动端测试**
   - iOS Safari / Chrome测试
   - Android Chrome / 微信内置浏览器测试
   - 性能profiling和优化
   - 用户体验测试（5-10个真实用户）

 **验收标准:**
 - 在iOS和Android上均可"添加到主屏幕"
 - Lighthouse移动端评分 > 90
 - 首屏加载时间 < 2秒（4G网络）
 - 小程序通过微信审核并上线

### 3.6 风险与挑战

#### 3.6.1 数据获取风险
| 风险 | 影响 | 应对策略 |
|------|------|----------|
| API限流 | 天气/地图数据无法实时更新 | 使用多个API备用,控制请求频率 |
| 爬虫被封 | 社交媒体数据缺失 | 降低爬取频率,使用代理池,手动补充 |
| 数据源失效 | 功能受限 | 定期检查数据源,准备替代方案 |

#### 3.6.2 法律合规风险
| 风险 | 影响 | 应对策略 |
|------|------|----------|
| 违反平台服务条款 | 账号被封,法律纠纷 | 仅爬取公开数据,低频访问,遵守robots.txt |
| 侵犯著作权 | 法律纠纷 | 不转载完整文章,仅显示摘要+链接 |

#### 3.6.3 技术挑战
| 挑战 | 解决方案 |
|------|----------|
| 反爬虫机制 | 使用Selenium模拟浏览器,代理IP轮换 |
| 数据清洗与标准化 | 编写数据处理脚本,统一格式 |
| 地图性能优化 | 使用聚合标记,分层加载 |
| 跨域请求限制 | 后端代理或CORS配置 |

#### 3.6.4 移动端风险与挑战
| 风险 | 影响 | 应对策略 |
|------|------|----------|
| **PWA兼容性问题** | iOS/Android表现不一致,部分功能无法使用 | 充分测试主流浏览器,准备fallback方案,iOS使用Safari特性检测 |
| **小程序审核被拒** | 无法上线微信生态,失去大量潜在用户 | 提前研究微信规范,避免违规功能,准备申诉材料,必要时调整功能 |
| **移动端性能问题** | 卡顿、发热、耗电,用户体验差 | 持续性能profiling,图片使用WebP格式,代码分割,减少重绘回流 |
| **定位权限被拒** | 无法使用附近城市推荐功能 | 优雅降级,允许手动选择位置,提供城市搜索和列表选择 |
| **离线数据存储超限** | 缓存失败,离线功能不可用 | 限制缓存城市数量(如最多50个),使用LRU策略自动清理旧数据 |
| **移动端浏览器适配** | 显示异常,交互失灵 | 主流浏览器测试,使用polyfill兼容旧版本,避免使用实验性API |
| **触摸手势冲突** | 地图缩放和页面滚动冲突 | 合理设置触摸区域,使用Hammer.js处理复杂手势,提供视觉反馈 |
| **网络环境差异** | 弱网环境下加载缓慢或失败 | 实现渐进式加载,优先加载关键资源,提供离线提示和重试机制 |
| **设备性能差异** | 低端设备卡顿,高端设备正常 | 检测设备性能,动态调整动画效果和渲染质量,提供流畅模式选项 |
| **电池消耗过快** | 用户卸载应用,评价降低 | 优化定位频率,减少后台任务,使用节能API,提供省电模式 |

### 3.7 成功指标

#### 3.7.1 数据完整性
- 目标城市覆盖数: 50+ (初期)
- 基础数据完整度: >90%
- 实时数据更新成功率: >95%

#### 3.7.2 功能可用性
- 地图加载成功率: >99%
- API调用成功率: >95%
- 数据更新及时性: 天气<1h延迟,新闻<24h延迟

#### 3.7.3 移动端性能指标
- **加载性能**:
  - 首屏加载时间: <2秒 (4G网络)
  - 交互响应延迟: <100ms
  - 初始加载体积: <500KB
- **运行性能**:
  - 内存占用: <100MB (单页面)
  - 电池消耗: 持续使用30分钟 < 5%
  - 帧率: 保持60fps (滚动和动画)
- **兼容性**:
  - iOS Safari: 支持添加到主屏幕
  - Android Chrome: 支持安装为应用
  - 微信内置浏览器: 功能正常
- **Lighthouse评分**: >90 (Performance / Accessibility / Best Practices)

#### 3.7.4 移动端用户体验
- **手势操作准确率**: >95% (缩放、滑动、长按)
- **离线功能可用性**: 已缓存城市数据可正常浏览
- **PWA安装率**: >30% (访问用户中的安装比例)
- **小程序指标**:
  - 审核通过率: 100% (首次提交)
  - 日活用户: 50+ (首月)
  - 分享率: >20% (用户主动分享)

#### 3.7.5 个人使用体验(初期)
- 查找城市信息耗时减少80%+
- 城市对比决策效率提升
- 发现至少3个新的潜在目标城市
- 移动端使用占比: >60% (总访问量的移动端占比)

### 3.8 未来扩展方向

#### 3.8.1 功能扩展
1. **AI推荐系统**
   - 根据用户偏好智能推荐城市
   - 生成个性化城市报告

2. **社区功能**
   - 用户分享亲身经历
   - 城市讨论区
   - 问答系统

3. **深度数据**
   - 城市职业机会分析
   - 远程工作友好度
   - 数字游民配套设施

4. **实地考察助手**
   - 推荐考察路线
   - 当地联系人网络
   - 短租房源聚合

#### 3.8.2 商业化可能(远期)
- 付费高级会员(深度数据)
- 城市咨询服务
- 广告合作(本地商家)
- 数据报告销售

### 3.9 技术架构建议

#### 3.9.1 推荐技术栈

**前端:**
```
框架: React 18
地图: Leaflet.js + react-leaflet (或高德地图React组件)
UI库: Ant Design / Material-UI
状态管理: Zustand / Redux Toolkit
图表: ECharts / Recharts
请求: Axios
构建: Vite
```

**后端(可选):**
```
运行时: Node.js
框架: Express / Koa
爬虫: Python + Scrapy + Selenium
定时任务: node-cron / APScheduler
数据处理: Pandas
```

**数据存储:**
```
初期: JSON文件 + LocalStorage
中期: MongoDB (灵活schema)
长期: PostgreSQL (关系数据) + Redis (缓存)
```

**部署:**
```
前端: Vercel / Netlify (免费)
后端: Railway / Render (免费额度)
爬虫: 本地定时运行 / 云服务器
```

#### 3.9.2 项目结构建议
```
slow-city-explorer/
├── frontend/                 # 前端项目
│   ├── src/
│   │   ├── components/       # 组件
│   │   │   ├── Map/         # 地图组件
│   │   │   ├── CityCard/    # 城市卡片
│   │   │   ├── Compare/     # 对比组件
│   │   │   └── ...
│   │   ├── pages/           # 页面
│   │   ├── hooks/           # 自定义Hooks
│   │   ├── services/        # API服务
│   │   ├── utils/           # 工具函数
│   │   └── assets/          # 静态资源
│   └── public/
│       └── data/            # 静态数据JSON
│
├── backend/ (可选)
│   ├── src/
│   │   ├── routes/          # 路由
│   │   ├── controllers/     # 控制器
│   │   ├── services/        # 业务逻辑
│   │   └── models/          # 数据模型
│   └── config/
│
├── scrapers/                # 爬虫脚本
│   ├── weather_scraper.py
│   ├── news_scraper.py
│   ├── social_scraper.py
│   └── poi_scraper.py
│
├── data/                    # 数据存储
│   ├── cities/              # 城市数据
│   ├── realtime/            # 实时数据
│   └── social/              # 社交媒体数据
│
└── docs/                    # 文档
    ├── API.md
    ├── DATA_SOURCE.md
    └── DEPLOYMENT.md
```

### 3.10 快速启动指南

#### 第一步: 数据准备
1. 列出你感兴趣的城市清单(10-20个)
2. 注册以下API密钥:
   - 高德地图开发者账号
   - 和风天气API Key
   - 聚合数据新闻API Key(可选)
3. 手动收集城市基础数据,整理成JSON格式

#### 第二步: 前端开发
1. 使用React + Vite搭建项目
2. 集成Leaflet.js地图
3. 实现城市标记与详情卡片
4. 接入天气API

#### 第三步: 数据爬取(可选)
1. 编写简单爬虫脚本
2. 定期更新房价、新闻数据
3. 手动收集社交媒体评价

#### 第四步: 部署上线
1. 前端部署到Vercel/Netlify
2. 数据存储在GitHub仓库(JSON文件)
3. 定期本地运行爬虫更新数据

## 四、附录

### 4.1 参考链接

**数据源API文档:**
- 高德地图: https://lbs.amap.com/api/
- 和风天气: https://dev.qweather.com/
- OpenStreetMap: https://www.openstreetmap.org/
- Numbeo: https://www.numbeo.com/

**竞品网站:**
- 明日故乡: https://www.hometown.plus/
- 百度慧眼: https://huiyan.baidu.com/

**技术文档:**
- AntV L7: https://l7.antv.antgroup.com/
- Leaflet.js: https://leafletjs.com/
- React Leaflet: https://react-leaflet.js.org/
- ECharts: https://echarts.apache.org/

### 4.2 词汇表

| 术语 | 解释 |
|------|------|
| POI | Point of Interest,兴趣点,如医院、学校、商场等 |
| 反爬虫 | 网站防止被爬虫抓取的技术手段 |
| API | Application Programming Interface,应用程序接口 |
| 热力图 | 用颜色深浅表示数据密度的可视化方式 |
| MVP | Minimum Viable Product,最小可行产品 |

### 4.3 版本记录

| 版本 | 日期 | 内容 |
|------|------|------|
| v1.0 | 2024-12-17 | 初始PRD文档 |

---

**文档作者:** Claude  
**最后更新:** 2024-12-17